Plan

 think about method names
  if returning something then a description of what they returning
  if doing something then verb and noun
  
 think about class names
  ideas from book
 
 think about variable names
  ideas from book
 
 have a base class
 
 maybe call nextline in writetag?
  less total code
  but less obvious
 
 try and have each parser bit as a separate class
  one class that has lines and line index and output
  one class for each parser (header etc)
  these have a base class
   base class takes the line / line index / output class
   and has pass through methods for currentline etc
  main parser class creates a list of parsers

 install sonar qube and see if it says anything
 
 install latest c# thingy and see if it has any recommendations

Done
 instance variables for lineIndex and current line
 Each parse now in control of the number of lines it reads
 Old list logic replaced
 instance variable for html output
 add a check to main loop to make sure that lineIndex always increases
 Use test / execute pattern thing
 instance variable for the result

 
Problems

No instance variables

public static string Parse(string markdown)
 list shouldn't be in this method, its also passed in as a var and an out
 reads one line at a time, this doesn't work for parsing a list
 
private static string ParseLine(string markdown, bool list, out bool inListAfter)
 using result == null is a bad way of indicating what kind of thing it is
 and list stuff
	
private static string ParseHeader(string markdown, bool list, out bool inListAfter)
 and list stuff
 could refactor the bit that works out how many #'s there are for the heading level
 remove the list stuff
 
private static string ParseParagraph(string markdown, bool list, out bool inListAfter)
 remove the list stuff

private static string ParseLineItem(string markdown, bool list, out bool inListAfter)
 this does the list stuff
 it needs to read everything in the list instead of being called one line at a time
 
private static string ParseText(string markdown, bool list)
 this gets called for <p>'s and when inside a list, which makes it harder
 
private static string Parse__(string markdown) => Parse(markdown, "__", "strong");
private static string Parse_(string markdown) => Parse(markdown, "_", "em");
 called from parse text
 would be good to make this fluent

private static string Parse(string markdown, string delimiter, string tag)
 this looks confusing and could be a lot easier